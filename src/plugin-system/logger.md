---
layout: layout.njk
eleventyNavigation:
  key: plugin-system-logger
  title: Logger
  order: 14
summary: Способ вывода сообщений для ваших пользователей
---

## Введение

Каждый раз, когда вы хотите что-то зарегистрировать в плагине, вам нужно пройти через регистратор. Каждой функции плагина передается экземпляр регистратора в качестве параметра. В этом экземпляре уже есть вся информация, необходимая Parcel, чтобы идентифицировать ваш плагин как источник сообщения.

Регистратор использует формат, который мы назвали [diagnostics](#diagnostics), который представляет собой объект JavaScript со стандартизованным набором свойств, [Reporter](/plugin-system/reporter/) использует эту информацию для регистрации вашего сообщения в целевом формате. имея полную свободу в том, как эти данные должны быть отформатированы и отображены.

There is a function for each type of log you can output, these functions are `verbose(diagnostic)`, `info(diagnostic)`, `log(diagnostic)`, `warn(diagnostic)` and `error(diagnostic)`. These log levels are used for defining the severity of your log message, this is useful for formatting and filtering. For example, the end user can use the flag [`--log-level`](/features/cli/#general-parameters) to define which messages it wants to see. Each of these functions also have a single parameter called diagnostic, this parameter can either be a single [diagnostic](#diagnostics) object or an array of [diagnostics](#diagnostics), depending on how many messages you want to log.

Существует функция для каждого типа журнала, который вы можете выводить, это функции `verbose(diagnostic)`, `info(diagnostic)`, `log(diagnostic)`, `warn(diagnostic)` and `error(diagnostic)`. Эти уровни журнала используются для определения серьезности вашего сообщения журнала, это полезно для форматирования и фильтрации. Например, конечный пользователь может использовать флаг [`--log-level`](/features/cli/#general-parameters), чтобы определить, какие сообщения он хочет видеть. У каждой из этих функций также есть единственный параметр, называемый диагностикой, этот параметр может быть либо одним объектом [diagnostic](#diagnostics), либо массивом [diagnostics](#diagnostics), в зависимости от того, сколько сообщений вы хотите зарегистрировать.

### Уровни журнала

| Level   | When to use                                                                                                                             | function(s)                                             |
| ------- | --------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------- |
| verbose | Используйте это, если вы хотите регистрировать все, что можно использовать для отладки проблем, но не особенно интересно для обычного использования | `logger.verbose(...)`                                   |
| info    | Используйте это для регистрации любой информации, не связанной с проблемой                                                                        | `logger.info(...)` or `logger.log(...)`                 |
| warning | Используйте это, чтобы регистрировать все, что связано с проблемой, которая не является критической.                                                                      | `logger.warning(...)`                                   |
| error   | Используйте это для регистрации любых критических проблем, вы, вероятно, захотите вместо этого выбросить ThrowableDiagnostic                                           | `logger.error(...)` или `throw ThrowableDiagnostic(...)` |

## Диагностика

`Diagnostic` - это объект JavaScript с предопределенным набором свойств, необходимых для создания полезного сообщения журнала, это может быть что угодно, от подробного сообщения до ошибки. Этот объект может включать сообщение, информацию о файле, кодовом кадре, информацию об ошибке и подсказки о том, как потенциально решить проблему.

### Свойства диагностики

#### General fields

- `message`(string): Это сообщение, которое вы хотите зарегистрировать.
- `filePath`(string): Путь к файлу, о котором идет речь в диагностике (необязательно)
- `language`(string): Язык файла, о котором идет речь (необязательно)
- `codeFrame`[(DiagnosticCodeFrame)](#diagnosticcodeframe): Кодовый фрейм указывает на определенные места в файле, с которым связана эта диагностика (необязательно)
- `hints`(Array\<string\>): Список строк, предлагающих способы решения этой проблемы. (по желанию)

#### Поля, связанные с ошибкой

Эти поля предназначены для тех случаев, когда вы описываете ошибку.

- `stack`(string): Трассировка стека ошибки (необязательно)
- `name`(string): Название ошибки (необязательно)

#### `DiagnosticCodeFrame`

The `DiagnosticCodeFrame` Объект описывает, как форматировать кодовый фрейм. Кадр кода - это визуализация фрагмента кода с определенным количеством выделенных фрагментов кода, которые указывают на определенные фрагменты внутри кода.

Для форматирования этих объектов мы создали нашу собственную библиотеку фреймов кода `@parcel/codeframe`, которая поддерживает несколько выделений и форматирование кода.

##### Свойства

- `code`(string): Содержимое исходного файла (не требуется, если для диагностики предоставляется filePath, однако вы должны быть на 100% уверены, что код, к которому применяется этот кодовый фрейм, по-прежнему идентичен коду в расположении filePath)
- `codeHighlights`: Массив объектов CodeHighlight
  - `start`({ line: number, column: number }): расположение первого символа, который должен быть выделен для этого выделения, строка и столбец начинаются с **1**
  - `end`({ line: number, column: number }): расположение последнего символа, который должен быть выделен для этого выделения, и строка, и столбец начинаются с **1**
  - `message`(string): Сообщение, которое должно отображаться в этом месте кода (необязательно)

### Форматирование сообщений

Чтобы отформатировать сообщения в диагностике, мы используем очень минимальную версию уценки, специально созданную для совместимости с терминалами и всем остальным, а также не слишком загадочную при отображении без какого-либо форматирования. Для нашего `@parcel/reporter-cli` мы используем нашу собственную библиотеку `@parcel/markdown-ansi`, которая преобразует эти строки уценки в escape-последовательности ANSI.

Поддерживаемые функции уценки: `**bold**`, `*italic*`/`_italic_`, `__underlined__` и `~~strikethrough~~`.

## Как записать сообщение

Когда вы познакомитесь с диагностическим форматом, вы сможете регистрировать все, что захотите, от подробных сообщений до ошибок с кодовыми кадрами и подсказками, чтобы вашим пользователям не приходилось часами искать в Интернете решение.

В случае ошибок вы также можете выдать ошибку, которая была дополнена диагностической информацией, это очень полезно для сбоя сборки, а также предоставляет полезное сообщение об ошибке с кодовым кадром и предложениями. Это также рекомендуемый способ выдачи ошибок в Parcel.

Пример каждого метода, который вы можете использовать:

```js
import { Transformer } from "@parcel/plugin";
import ThrowableDiagnostic from "@parcel/diagnostic";

export default new Transformer({
  // ...

  async transform({ asset, ast, config, logger, resolve, options }) {
    logger.verbose({
      message: "Started transforming a dummy asset",
      filePath: asset.filePath,
      language: asset.type,
    });

    logger.info([
      {
        message: "This is an example message",
        filePath: asset.filePath,
        language: asset.type,
      },
      {
        message: "This is another example message",
        filePath: asset.filePath,
        language: asset.type,
      },
    ]);

    logger.warn({
      message: "This is an example message",
      filePath: asset.filePath,
      language: asset.type,
    });

    try {
      loadDummyCompiler();
    } catch (err) {
      throw new ThrowableDiagnostic({
        diagnostic: {
          message: err.message,
          filePath: asset.filePath,
          language: asset.type,
          stack: err.stack,
          name: err.name,
          codeFrame: {
            code: await asset.getCode(),
            codeHighlights: [
              {
                start: {
                  line: 1,
                  column: 5,
                },
                end: {
                  line: 2,
                  column: 3,
                },
                message: "Это пример сообщения внутри **codeframe**",
              },
            ],
          },
          hints: [
            "Install __@dummy/compiler__ using *npm install @dummy/compiler*",
          ],
        },
      });
    }

    // ...
  },
});
```

## Автоматически собираемые логи и ошибки

Ядро Parcel автоматически собирает все журналы, созданные вызовом глобальной переменной `console`.Это означает, что всякий раз, когда вы создаете `console.log`, мы внутренне перехватываем его и конвертируем в объект диагностики. Это не рекомендуется, поскольку у нас не так много информации, как при прямом вызове экземпляра регистратора. Мы также делаем то же самое для ошибок: всякий раз, когда вы выдаете ошибку, мы конвертируем ее в диагностику, добавляем к ней информацию о плагине и отправляем ее регистратору.
